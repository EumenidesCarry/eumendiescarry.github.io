

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="ECarry">
  <meta name="keywords" content="">
  <title>关于 Linux 分区的小事 - ECarry的博客</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
    
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ECarry's blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/photo/">
                <i class="iconfont icon-images"></i>
                相册
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('https://w.wallhaven.cc/full/4y/wallhaven-4y1kkd.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-06-09 15:32" pubdate>
        2020年6月9日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      9.2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      127
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">关于 Linux 分区的小事</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2020年9月18日 下午
                
              </p>
            
            <div class="markdown-body" id="post-body">
              <h1 id="一、分区"><a href="#一、分区" class="headerlink" title="一、分区"></a>一、分区</h1><blockquote>
<p>分区是为了在逻辑上将某些柱面隔开形成边界。它是以柱面为单位来划分的，但是从CentOS 7开始，是按照扇区进行划分的。</p>
<p>在磁盘数据量非常大的情况下，划分分区的好处是扫描块位图等更快速：不用再扫描整块磁盘的块位图，只需扫描对应分区的块位图。</p>
</blockquote>
<h2 id="1-1-分区方法（MBR、GPT）"><a href="#1-1-分区方法（MBR、GPT）" class="headerlink" title="1.1 分区方法（MBR、GPT）"></a>1.1 分区方法（MBR、GPT）</h2><h3 id="1-1-1-MBR"><a href="#1-1-1-MBR" class="headerlink" title="1.1.1 MBR"></a>1.1.1 MBR</h3><p>MBR格式的磁盘中，会维护磁盘第一个扇区——MBR扇区，在该扇区中第446字节之后的64字节是分区表，每个分区占用16字节，所以限制了一块磁盘最多只能有4个主分区(Primary,P)，如果多于4个区，只能将主分区少于4个，通过建立扩展分区(Extend,E)，然后在扩展分区建立逻辑分区(Logical,L)的方式来突破4个分区的限制，逻辑分区的数量不限制。</p>
<p>在Linux中，MBR格式的磁盘主分区号从1-4，扩展分区号从2-4，逻辑分区号从5开始。</p>
<p><strong>例如</strong>，一块盘想分成6个分区，可以：</p>
<p>1P+5L：sda1+sda5+sda6+sda7+sda8+sda9</p>
<p>2P+4L：sda1+sda2+sda5+sda6+sda7+sda8</p>
<p>3P+3L：sda1+sda2+sda3+sda5+sda6+sda7</p>
<h3 id="1-1-2-GPT"><a href="#1-1-2-GPT" class="headerlink" title="1.1.2 GPT"></a>1.1.2 GPT</h3><p>GPT格式突破了MBR的限制，它不再限制只能存储4个分区表条目，而是使用了类似MBR扩展分区表条目的格式，它允许有128个主分区，这也使得它可以对超过2TB的磁盘进行分区。</p>
<h2 id="1-2-MBR-和-GPT-分区表信息"><a href="#1-2-MBR-和-GPT-分区表信息" class="headerlink" title="1.2 MBR 和 GPT 分区表信息"></a>1.2 MBR 和 GPT 分区表信息</h2><p>在MBR格式分区表中，MBR扇区占用512个字节，前446个字节是主引导记录，即boot loader。中间64字节记录着分区表信息，每个主分区信息占用16字节，因此最多只能有4个主分区，最后2个字节是有效标识位。如果使用扩展分区，则扩展分区对应的16字节记录的是指向扩展分区中扩展分区表的指针。</p>
<p><img src="/img/linux_part/linux_part_1.png" srcset="/img/loading.gif"></p>
<p>在MBR磁盘上，分区和启动信息是保存在一起的，如果这部分数据被覆盖或破坏，只能重建MBR。而GPT在整个磁盘上保存多个这部分信息的副本，因此它更为健壮，并可以恢复被破坏的这部分信息。GPT还为这些信息保存了循环冗余校验码(CRC)以保证其完整和正确，如果数据被破坏，GPT会发现这些破坏，并从磁盘上的其他地方进行恢复。</p>
<p>下面是GPT格式的分区表信息，大致约占17个字节。</p>
<p><img src="/img/linux_part/linux_part_2.png" srcset="/img/loading.gif"></p>
<p>EFI部分可以分为4个区域：EFI信息区(GPT头)、分区表、GPT分区区域和备份区域。</p>
<ul>
<li>EFI信息区(GPT头)：起始于磁盘的LBA1，通常也只占用这个单一扇区。其作用是定义分区表的位置和大小。GPT头还包含头和分区表的校验和，这样就可以及时发现错误。</li>
<li>分区表：分区表区域包含分区表项。这个区域由GPT头定义，一般占用磁盘LBA2～LBA33扇区，每扇区可存储4个主分区的分区信息，所以共能分128个主分区。分区表中的每个分区项由起始地址、结束地址、类型值、名字、属性标志、GUID值组成。分区表建立后，128位的GUID对系统来说是唯一的。</li>
<li>GPT分区：最大的区域，由分配给分区的扇区组成。这个区域的起始和结束地址由GPT头定义。</li>
<li>备份区：备份区域位于磁盘的尾部，包含GPT头和分区表的备份。它占用GPT结束扇区和EFI结束扇区之间的33个扇区。其中最后一个扇区用来备份1号扇区的EFI信息，其余的32个扇区用来备份LBA2～LBA33扇区的分区表。</li>
</ul>
<h2 id="1-3-添加磁盘"><a href="#1-3-添加磁盘" class="headerlink" title="1.3 添加磁盘"></a>1.3 添加磁盘</h2><p>正常情况下，添加磁盘后需要重启系统才能被内核识别，在 /dev/ 下才有对应的设备号，使用 fdisk -l 才会显示出来。但是有时候不方便重启，所以下面介绍一种磁盘热插拔方式。</p>
<h3 id="1-3-1-Linux上磁盘热插拔"><a href="#1-3-1-Linux上磁盘热插拔" class="headerlink" title="1.3.1 Linux上磁盘热插拔"></a>1.3.1 Linux上磁盘热插拔</h3><p>获取 SCSI 设备信息：</p>
<pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>localhost ~]# lsscsi
[<span class="hljs-number">1</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>]    cd/dvd  QEMU     QEMU DVD-ROM     <span class="hljs-number">2.5</span>+  /dev/sr0 
[<span class="hljs-number">2</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>]    disk    WD       Elements SE <span class="hljs-number">25</span>FE <span class="hljs-number">1021</span>  /dev/sdb 
[<span class="hljs-number">2</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">1</span>]    enclosu WD       SES Device       <span class="hljs-number">1021</span>  -        
[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>]    disk    QEMU     QEMU HARDDISK    <span class="hljs-number">2.5</span>+  /dev/sda</code></pre>

<p>有些操作系统没有 lsscsi 命令，则可以使用下面的方法获取 scsi 设备信息：</p>
<pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>localhost ~]# ll /sys/bus/scsi/drivers/sd/
总用量 <span class="hljs-number">0</span>
lrwxrwxrwx. <span class="hljs-number">1</span> root root    <span class="hljs-number">0</span> <span class="hljs-number">8</span>月   <span class="hljs-number">9</span> <span class="hljs-number">15</span>:<span class="hljs-number">54</span> <span class="hljs-number">2</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span> -&gt; ../../../../devices/pci0000:<span class="hljs-number">00</span>/<span class="hljs-number">0000</span>:<span class="hljs-number">00</span>:<span class="hljs-number">1</span>e<span class="hljs-number">.0</span>/<span class="hljs-number">0000</span>:<span class="hljs-number">01</span>:<span class="hljs-number">1</span>b<span class="hljs-number">.0</span>/usb3/<span class="hljs-number">3</span><span class="hljs-number">-1</span>/<span class="hljs-number">3</span><span class="hljs-number">-1</span>:<span class="hljs-number">1.0</span>/host2/target2:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>/<span class="hljs-number">2</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>
lrwxrwxrwx. <span class="hljs-number">1</span> root root    <span class="hljs-number">0</span> <span class="hljs-number">8</span>月   <span class="hljs-number">9</span> <span class="hljs-number">15</span>:<span class="hljs-number">54</span> <span class="hljs-number">3</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span> -&gt; ../../../../devices/pci0000:<span class="hljs-number">00</span>/<span class="hljs-number">0000</span>:<span class="hljs-number">00</span>:<span class="hljs-number">05.0</span>/virtio1/host3/target3:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>/<span class="hljs-number">3</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>
--w-------. <span class="hljs-number">1</span> root root <span class="hljs-number">4096</span> <span class="hljs-number">8</span>月   <span class="hljs-number">9</span> <span class="hljs-number">15</span>:<span class="hljs-number">54</span> bind
--w-------. <span class="hljs-number">1</span> root root <span class="hljs-number">4096</span> <span class="hljs-number">7</span>月  <span class="hljs-number">20</span> <span class="hljs-number">18</span>:<span class="hljs-number">39</span> uevent
--w-------. <span class="hljs-number">1</span> root root <span class="hljs-number">4096</span> <span class="hljs-number">8</span>月   <span class="hljs-number">9</span> <span class="hljs-number">15</span>:<span class="hljs-number">54</span> unbind
[<span class="hljs-symbol">root@</span>localhost ~]# ll /sys/bus/scsi/drivers/sd/<span class="hljs-number">2</span>\:<span class="hljs-number">0</span>\:<span class="hljs-number">0</span>\:<span class="hljs-number">0</span>/block/
总用量 <span class="hljs-number">0</span>
drwxr-xr-x. <span class="hljs-number">8</span> root root <span class="hljs-number">0</span> <span class="hljs-number">7</span>月  <span class="hljs-number">20</span> <span class="hljs-number">18</span>:<span class="hljs-number">39</span> sdb</code></pre>

<p>然后查看 /proc/scsi/scsi 文件，获取对应scsi设备的详细信息：</p>
<pre><code class="hljs tcl">[root@localhost ~]# cat /<span class="hljs-keyword">proc</span>/scsi/scsi 
Attached<span class="hljs-title"> devices:</span>
<span class="hljs-title">Host:</span> scsi1<span class="hljs-title"> Channel:</span> 00<span class="hljs-title"> Id:</span> 00<span class="hljs-title"> Lun:</span> 00
<span class="hljs-title">  Vendor:</span> QEMU<span class="hljs-title">     Model:</span> QEMU<span class="hljs-title"> DVD-ROM</span> <span class="hljs-title">    Rev:</span> 2.5+
<span class="hljs-title">  Type:</span> <span class="hljs-title">  CD-ROM</span> <span class="hljs-title">                          ANSI</span> <span class="hljs-title"> SCSI</span> revision: 05
Host:<span class="hljs-title"> scsi3</span> Channel: 00<span class="hljs-title"> Id:</span> 00<span class="hljs-title"> Lun:</span> 00				&lt;-----/dev/sda
<span class="hljs-title">  Vendor:</span> QEMU<span class="hljs-title">     Model:</span> QEMU<span class="hljs-title"> HARDDISK</span> <span class="hljs-title">   Rev:</span> 2.5+
<span class="hljs-title">  Type:</span> <span class="hljs-title">  Direct-Access</span> <span class="hljs-title">                   ANSI</span> <span class="hljs-title"> SCSI</span> revision: 05
Host:<span class="hljs-title"> scsi2</span> Channel: 00<span class="hljs-title"> Id:</span> 00<span class="hljs-title"> Lun:</span> 00				&lt;-----/dev/sdb
<span class="hljs-title">  Vendor:</span> WD<span class="hljs-title">       Model:</span> Elements<span class="hljs-title"> SE</span> 25FE<span class="hljs-title"> Rev:</span> 1021
<span class="hljs-title">  Type:</span> <span class="hljs-title">  Direct-Access</span> <span class="hljs-title">                   ANSI</span> <span class="hljs-title"> SCSI</span> revision: 06
Host:<span class="hljs-title"> scsi2</span> Channel: 00<span class="hljs-title"> Id:</span> 00<span class="hljs-title"> Lun:</span> 01				
<span class="hljs-title">  Vendor:</span> WD<span class="hljs-title">       Model:</span> SES<span class="hljs-title"> Device</span> <span class="hljs-title">      Rev:</span> 1021
<span class="hljs-title">  Type:</span> <span class="hljs-title">  Enclosure</span> <span class="hljs-title">                       ANSI</span> <span class="hljs-title"> SCSI</span> revision: 06</code></pre>

<p>在此处，有两块<strong>直连</strong>(<strong>Direct-Access</strong>)的 scsi 磁盘，一块通过光驱cd-rom连接的光盘。我们只考虑 scsi 磁盘，所以这两块磁盘在 scsi 中的定位符为2:0:0:0和3:0:0:0。<strong>如果继续插入一块盘，那么新盘在scsi中的定位符可能为4:0:0:0</strong>，这个数值串非常重要。</p>
<h4 id="热插"><a href="#热插" class="headerlink" title="热插"></a>热插</h4><p>在向计算机中插入一块磁盘后，内核因为识别不了它所以不会产生任何事件通知，因此在 /sys 目录中不会产生任何文件，任何工具也就读取不了它。重启系统肯定是可以解决的，但是Linux支持热插。</p>
<p>热插新盘的方式是向 /proc/scsi/scsi 中写入新 scsi 设备的信息。方式如下：</p>
<p><code>echo &quot;scsi add-single-device a b c d&quot; &gt;/proc/scsi/scsi</code></p>
<p>其中：</p>
<p>   a == hostadapter id (first one being 0)</p>
<p>   b == SCSI channel on hostadapter (first one being 0)</p>
<p>   c == ID</p>
<p>   d == LUN (first one being 0)</p>
<p>例如上面的例子，应该添加如下信息：</p>
<p><code>[root@localhost ~]# echo &quot;scsi add-single-device 4:0:0:0&quot; &gt;/proc/scsi/scsi</code></p>
<p>重新扫描 scsi 总线也可以实现热插的功能，查看主机 SCSI 总线号：</p>
<pre><code class="hljs gradle">[root@localhost ~]# ls <span class="hljs-regexp">/sys/</span><span class="hljs-keyword">class</span><span class="hljs-regexp">/scsi_host/</span>
host0  host1  host2  host3
#重新扫描scsi总线以热插拔方式添加新设备。
[root@localhost ~]# echo <span class="hljs-string">&quot;- - -&quot;</span> &gt; <span class="hljs-regexp">/sys/</span><span class="hljs-keyword">class</span><span class="hljs-regexp">/scsi_host/</span>host0/scan
[root@localhost ~]# echo <span class="hljs-string">&quot;- - -&quot;</span> &gt; <span class="hljs-regexp">/sys/</span><span class="hljs-keyword">class</span><span class="hljs-regexp">/scsi_host/</span>host1/scan
[root@localhost ~]# echo <span class="hljs-string">&quot;- - -&quot;</span> &gt; <span class="hljs-regexp">/sys/</span><span class="hljs-keyword">class</span><span class="hljs-regexp">/scsi_host/</span>host2/scan
[root@localhost ~]# echo <span class="hljs-string">&quot;- - -&quot;</span> &gt; <span class="hljs-regexp">/sys/</span><span class="hljs-keyword">class</span><span class="hljs-regexp">/scsi_host/</span>host3/scan
[root@localhost ~]# fdisk -l      # 再查看就有了</code></pre>

<p>如果 scsi_host 目录系很多hostN目录，则使用循环来完成：</p>
<pre><code class="hljs gradle">[root@localhost ~]# ls <span class="hljs-regexp">/sys/</span><span class="hljs-keyword">class</span><span class="hljs-regexp">/scsi_host/</span>
host0   host11  host14  host17  host2   host22  host25  host28  host30  host4  host7
host1   host12  host15  host18  host20  host23  host26  host29  host31  host5  host8
host10  host13  host16  host19  host21  host24  host27  host3   host32  host6  host9

[root@localhost ~]# <span class="hljs-keyword">for</span> i in <span class="hljs-regexp">/sys/</span><span class="hljs-keyword">class</span><span class="hljs-regexp">/scsi_host/</span>host*/scan;<span class="hljs-keyword">do</span> echo <span class="hljs-string">&quot;- - -&quot;</span> &gt;$i;done</code></pre>

<p>热插之后，fdisk -l等命令就可以识别到该磁盘了。</p>
<h4 id="热拔"><a href="#热拔" class="headerlink" title="热拔"></a>热拔</h4><p>热拔磁盘的方式是在 /proc/scsi/scsi 中移除对应 scsi 设备的信息。方式如下：</p>
<p><code>echo &quot;scsi remove-single-device a b c d&quot; &gt;/proc/scsi/scsi</code></p>
<p>例如删除2:0:0:0这块磁盘：</p>
<p><code>[root@localhost ~]# echo &quot;scsi remove-single-device 2 0 0 0&quot; &gt;/proc/scsi/scsi</code></p>
<p>因为要删除的设备已经存在，/sys中已经有它完整的信息，所以也从其自身设备上进行删除。</p>
<p>首先查看scsi设备信息:</p>
<pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>localhost ~]# lsscsi
[<span class="hljs-number">1</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>]    cd/dvd  QEMU     QEMU DVD-ROM     <span class="hljs-number">2.5</span>+  /dev/sr0 
[<span class="hljs-number">2</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>]    disk    WD       Elements SE <span class="hljs-number">25</span>FE <span class="hljs-number">1021</span>  /dev/sdb 
[<span class="hljs-number">2</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">1</span>]    enclosu WD       SES Device       <span class="hljs-number">1021</span>  -        
[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>]    disk    QEMU     QEMU HARDDISK    <span class="hljs-number">2.5</span>+  /dev/sda</code></pre>

<p> 例如要删除 /dev/sdb，即2:0:0:0。先看看它的文件信息：</p>
<pre><code class="hljs routeros">[root@localhost ~]# ls /sys/bus/scsi/drivers/sd/2\:0\:0\:0/
block           driver                        evt_mode_parameter_change_reported  ioerr_cnt      queue_depth  scsi_generic  uevent
bsg             eh_timeout                    evt_soft_threshold_reached          iorequest_cnt  queue_type   scsi_level    unpriv_sgio
delete          evt_capacity_change_reported  generic                             max_sectors    rescan       state         vendor
device_blocked  evt_inquiry_change_reported   inquiry                             modalias       rev          subsystem     vpd_pg80
device_busy     evt_lun_change_reported       iocounterbits                       model          scsi_device  timeout       vpd_pg83
dh_state        evt_media_change              iodone_cnt                          power          scsi_disk   <span class="hljs-built_in"> type </span>         wwid</code></pre>

<p>在其中有3个文件：delete、rescan和state。其中state记录了该设备是否正在运行中。而delete和rescan文件则用于删除和重新扫描该设备。</p>
<p>例如，删除该设备，即热拔：</p>
<p><code>[root@localhost ~]# echo 1 &gt; /sys/bus/scsi/drivers/sd/2\:0\:0\:0/delete</code></p>
<h2 id="1-4-使用-fdisk-分区工具"><a href="#1-4-使用-fdisk-分区工具" class="headerlink" title="1.4 使用 fdisk 分区工具"></a>1.4 使用 fdisk 分区工具</h2><p>fdisk 工具用来分 MBR 磁盘上的区。要分 GPT 磁盘上的区，可以使用 gdisk。parted工具对这两种格式的磁盘分区都支持。</p>
<p>如果一个存储设备已经分过区，那么它可能是mbr格式的，也可能是gpt格式的，如果已经是mbr格式的，则只能继续使用fdisk进行分区，如果已经是gpt格式的，则只能使用gdisk进行分区。当然，无论什么格式的都可以使用parted进行分区，只不过也只能划分和已存在分区格式一样的分区，因为无论何种格式的分区，它的分区表和分区标识是已经固定的。</p>
<p>使用fdisk分区，它只能实现MBR格式的分区：</p>
<pre><code class="hljs sql">[root@localhost ~]<span class="hljs-comment"># fdisk /dev/sda</span>
欢迎使用 fdisk (util-linux 2.23.2)。

更改将停留在内存中，直到您决定将更改写入磁盘。
使用写入命令前请三思。


命令(输入 m 获取帮助)：m
命令操作
   a   toggle a bootable flag
   b   edit bsd disklabel
   c   toggle the dos compatibility flag
   d   <span class="hljs-keyword">delete</span> a <span class="hljs-keyword">partition</span>
   g   <span class="hljs-keyword">create</span> a <span class="hljs-keyword">new</span> <span class="hljs-keyword">empty</span> GPT <span class="hljs-keyword">partition</span> <span class="hljs-keyword">table</span>	<span class="hljs-comment">#新版本 fdisk 开始支持 GPT 分区了</span>
   G   <span class="hljs-keyword">create</span> an IRIX (SGI) <span class="hljs-keyword">partition</span> <span class="hljs-keyword">table</span>
   l   <span class="hljs-keyword">list</span> known <span class="hljs-keyword">partition</span> types
   m   print this menu
   n   <span class="hljs-keyword">add</span> a <span class="hljs-keyword">new</span> <span class="hljs-keyword">partition</span>
   o   <span class="hljs-keyword">create</span> a <span class="hljs-keyword">new</span> <span class="hljs-keyword">empty</span> DOS <span class="hljs-keyword">partition</span> <span class="hljs-keyword">table</span>
   p   print the <span class="hljs-keyword">partition</span> <span class="hljs-keyword">table</span>
   q   quit <span class="hljs-keyword">without</span> saving changes
   s   <span class="hljs-keyword">create</span> a <span class="hljs-keyword">new</span> <span class="hljs-keyword">empty</span> Sun disklabel
   t   <span class="hljs-keyword">change</span> a <span class="hljs-keyword">partition</span><span class="hljs-string">&#x27;s system id</span>
<span class="hljs-string">   u   change display/entry units</span>
<span class="hljs-string">   v   verify the partition table</span>
<span class="hljs-string">   w   write table to disk and exit</span>
<span class="hljs-string">   x   extra functionality (experts only)</span>
<span class="hljs-string"></span>
<span class="hljs-string">命令(输入 m 获取帮助)：p</span>
<span class="hljs-string"></span>
<span class="hljs-string">磁盘 /dev/sda：21.5 GB, 21474836480 字节，41943040 个扇区</span>
<span class="hljs-string">Units = 扇区 of 1 * 512 = 512 bytes</span>
<span class="hljs-string">扇区大小(逻辑/物理)：512 字节 / 512 字节</span>
<span class="hljs-string">I/O 大小(最小/最佳)：512 字节 / 512 字节</span>
<span class="hljs-string">磁盘标签类型：dos</span>
<span class="hljs-string">磁盘标识符：0x000c7ad0</span>
<span class="hljs-string"></span>
<span class="hljs-string">   设备 Boot      Start         End      Blocks   Id  System</span>
<span class="hljs-string">/dev/sda1   *        2048     2099199     1048576   83  Linux</span>
<span class="hljs-string">/dev/sda2         2099200    41943039    19921920   8e  Linux LVM</span>
<span class="hljs-string"></span>
<span class="hljs-string">命令(输入 m 获取帮助)：n			#新建分区</span>
<span class="hljs-string">Partition type:</span>
<span class="hljs-string">   p   primary (2 primary, 0 extended, 2 free)	#总共可建4个主分区，现有2个，还剩可建两个</span>
<span class="hljs-string">   e   extended		#扩展分区</span>
<span class="hljs-string">Select (default p): p</span>
<span class="hljs-string">分区号 (3,4，默认 3)：</span>
<span class="hljs-string">#建立完分区注意保存</span>
<span class="hljs-string">Command (m for help): w  </span>
<span class="hljs-string">The partition table has been altered!</span>
<span class="hljs-string"></span>
<span class="hljs-string">Calling ioctl() to re-read partition table.</span>
<span class="hljs-string">Syncing disks.</span></code></pre>

<p>上面的 fdisk 操作全部是在内存中执行的，必须保存生效。保存后，内核还未识别该分区，可以查看 /proc/partition 目录下存在的文件，这些文件是能被内核识别的分区。运行<strong>partprobe</strong>或<strong>partx</strong>命令重新读取分区表让内核识别新的分区，内核识别后才可以格式化。而且分区结束时按w保存分区表有时候会失败，提示重启，这时候运行partprobe命令可以代替重启就生效。</p>
<pre><code class="hljs gradle">[root@localhost ~]# partprobe <span class="hljs-regexp">/dev/</span>sdb	#也可指定在 <span class="hljs-regexp">/dev/</span>sdb 上重加载分区表</code></pre>

<h2 id="1-5-使用-gdisk-分区工具"><a href="#1-5-使用-gdisk-分区工具" class="headerlink" title="1.5 使用 gdisk 分区工具"></a>1.5 使用 gdisk 分区工具</h2><p>使用 gdsik 需要安装这个工具包：</p>
<pre><code class="hljs autoit">[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># yum -y install gdisk</span></code></pre>

<p>分区的时候直接带上设备即可。以下是对新硬盘划分gpt分区的过程：</p>
<pre><code class="hljs sql">[root@localhost ~]<span class="hljs-comment"># gdisk /dev/sdb</span>
GPT fdisk (gdisk) version 0.8.10

Partition table scan:
  MBR: not present
  BSD: not present
  APM: not present
  GPT: not present

Creating new GPT entries.

Command (? for <span class="hljs-keyword">help</span>): ?
b       back up GPT <span class="hljs-keyword">data</span> <span class="hljs-keyword">to</span> a <span class="hljs-keyword">file</span>
c       <span class="hljs-keyword">change</span> a <span class="hljs-keyword">partition</span><span class="hljs-string">&#x27;s name</span>
<span class="hljs-string">d       delete a partition                               # 删除分区</span>
<span class="hljs-string">i       show detailed information on a partition         # 列出分区详细信息</span>
<span class="hljs-string">l       list known partition types                       # 列出所以已知的分区类型</span>
<span class="hljs-string">n       add a new partition                              # 添加新分区</span>
<span class="hljs-string">o       create a new empty GUID partition table (GPT)    # 创建一个新的空的guid分区表</span>
<span class="hljs-string">p       print the partition table                        # 输出分区表信息</span>
<span class="hljs-string">q       quit without saving changes                      # 退出gdisk工具</span>
<span class="hljs-string">r       recovery and transformation options (experts only) </span>
<span class="hljs-string">s       sort partitions                                </span>
<span class="hljs-string">t       change a partition&#x27;</span>s <span class="hljs-keyword">type</span> code                   <span class="hljs-comment"># 修改分区类型</span>
v       <span class="hljs-keyword">verify</span> disk
w       write <span class="hljs-keyword">table</span> <span class="hljs-keyword">to</span> disk <span class="hljs-keyword">and</span> <span class="hljs-keyword">exit</span>                     <span class="hljs-comment"># 将分区信息写入到磁盘</span>
x       extra functionality (experts <span class="hljs-keyword">only</span>)             
?       print this menu
Command (? <span class="hljs-keyword">for</span> <span class="hljs-keyword">help</span>): n   	<span class="hljs-comment">#添加一个新分区</span>
<span class="hljs-keyword">Partition</span> <span class="hljs-built_in">number</span> (<span class="hljs-number">1</span><span class="hljs-number">-128</span>, <span class="hljs-keyword">default</span> <span class="hljs-number">1</span>):
<span class="hljs-keyword">First</span> sector (<span class="hljs-number">34</span><span class="hljs-number">-41943006</span>, <span class="hljs-keyword">default</span> = <span class="hljs-number">2048</span>) <span class="hljs-keyword">or</span> &#123;+-&#125;<span class="hljs-keyword">size</span>&#123;KMGTP&#125;:
<span class="hljs-keyword">Last</span> sector (<span class="hljs-number">2048</span><span class="hljs-number">-41943006</span>, <span class="hljs-keyword">default</span> = <span class="hljs-number">41943006</span>) <span class="hljs-keyword">or</span> &#123;+-&#125;<span class="hljs-keyword">size</span>&#123;KMGTP&#125;: +<span class="hljs-number">10</span>G
<span class="hljs-keyword">Current</span> <span class="hljs-keyword">type</span> <span class="hljs-keyword">is</span> <span class="hljs-string">&#x27;Linux filesystem&#x27;</span>
<span class="hljs-keyword">Hex</span> code <span class="hljs-keyword">or</span> GUID (L <span class="hljs-keyword">to</span> <span class="hljs-keyword">show</span> codes, Enter = <span class="hljs-number">8300</span>):
<span class="hljs-keyword">Changed</span> <span class="hljs-keyword">type</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">partition</span> <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;Linux filesystem&#x27;</span>
 
Command (? <span class="hljs-keyword">for</span> <span class="hljs-keyword">help</span>): p
Disk /dev/sdb: <span class="hljs-number">41943040</span> sectors, <span class="hljs-number">20.0</span> GiB
<span class="hljs-keyword">Logical</span> sector <span class="hljs-keyword">size</span>: <span class="hljs-number">512</span> <span class="hljs-keyword">bytes</span>
Disk identifier (GUID): F8AE925F<span class="hljs-number">-515</span>F<span class="hljs-number">-4807</span><span class="hljs-number">-92</span>ED<span class="hljs-number">-4109</span>D0827191
<span class="hljs-keyword">Partition</span> <span class="hljs-keyword">table</span> holds up <span class="hljs-keyword">to</span> <span class="hljs-number">128</span> entries
<span class="hljs-keyword">First</span> <span class="hljs-keyword">usable</span> sector <span class="hljs-keyword">is</span> <span class="hljs-number">34</span>, <span class="hljs-keyword">last</span> <span class="hljs-keyword">usable</span> sector <span class="hljs-keyword">is</span> <span class="hljs-number">41943006</span>
<span class="hljs-keyword">Partitions</span> will be aligned <span class="hljs-keyword">on</span> <span class="hljs-number">2048</span>-sector boundaries
Total free <span class="hljs-keyword">space</span> <span class="hljs-keyword">is</span> <span class="hljs-number">20971453</span> sectors (<span class="hljs-number">10.0</span> GiB)
 
<span class="hljs-built_in">Number</span>  <span class="hljs-keyword">Start</span> (sector)    <span class="hljs-keyword">End</span> (sector)  <span class="hljs-keyword">Size</span>       Code  <span class="hljs-keyword">Name</span>
   <span class="hljs-number">1</span>            <span class="hljs-number">2048</span>        <span class="hljs-number">20973567</span>   <span class="hljs-number">10.0</span> GiB    <span class="hljs-number">8300</span>  Linux filesystem

Command (? <span class="hljs-keyword">for</span> <span class="hljs-keyword">help</span>): i   <span class="hljs-comment"># 查看分区详细信息</span>
<span class="hljs-keyword">Using</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">Partition</span> GUID code: <span class="hljs-number">0</span>FC63DAF<span class="hljs-number">-8483</span><span class="hljs-number">-4772</span><span class="hljs-number">-8E79</span><span class="hljs-number">-3</span>D69D8477DE4 (Linux filesystem)
<span class="hljs-keyword">Partition</span> <span class="hljs-keyword">unique</span> GUID: B2452103<span class="hljs-number">-4</span>F32<span class="hljs-number">-4</span>B60-AEF7<span class="hljs-number">-4</span>BA42B7BF089
<span class="hljs-keyword">First</span> sector: <span class="hljs-number">2048</span> (<span class="hljs-keyword">at</span> <span class="hljs-number">1024.0</span> KiB)
<span class="hljs-keyword">Last</span> sector: <span class="hljs-number">20973567</span> (<span class="hljs-keyword">at</span> <span class="hljs-number">10.0</span> GiB)
<span class="hljs-keyword">Partition</span> <span class="hljs-keyword">size</span>: <span class="hljs-number">20971520</span> sectors (<span class="hljs-number">10.0</span> GiB)
<span class="hljs-keyword">Attribute</span> flags: <span class="hljs-number">0000000000000000</span>
<span class="hljs-keyword">Partition</span> <span class="hljs-keyword">name</span>: <span class="hljs-string">&#x27;Linux filesystem&#x27;</span>

Command (? <span class="hljs-keyword">for</span> <span class="hljs-keyword">help</span>): w 		<span class="hljs-comment">#保存分区表到磁盘</span>

<span class="hljs-keyword">Final</span> checks complete. About <span class="hljs-keyword">to</span> write GPT data. THIS WILL OVERWRITE EXISTING
<span class="hljs-keyword">PARTITIONS</span>!!

<span class="hljs-keyword">Do</span> you want <span class="hljs-keyword">to</span> proceed? (Y/N): Y
OK; writing new GUID partition table (GPT) to /dev/sdb.
The operation has completed successfully.

<span class="hljs-comment">#执行partprobe重新读取分区表信息</span>
[root@localhost ~]<span class="hljs-comment"># partprobe /dev/sdb</span></code></pre>

<h2 id="1-6-使用-parted-分区"><a href="#1-6-使用-parted-分区" class="headerlink" title="1.6 使用 parted 分区"></a>1.6 使用 parted 分区</h2><p>parted 支持 mbr 格式和 gpt 格式的磁盘分区。它的强大在于可以一步到位而不需要不断的交互式输入(也可以交互式)。</p>
<p>parted分区工具是实时的，所以每一步操作都是直接写入磁盘而不是写进内存，它不像 fdisk/gdisk 还需要 w 命令将内存中的结果保存到磁盘中。</p>
<pre><code class="hljs pgsql">[root@localhost ~]# parted /dev/sdc
GNU Parted <span class="hljs-number">2.1</span>
<span class="hljs-keyword">Using</span> /dev/sdc
Welcome <span class="hljs-keyword">to</span> GNU Parted! <span class="hljs-keyword">Type</span> <span class="hljs-string">&#x27;help&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">view</span> a list <span class="hljs-keyword">of</span> commands.
 
(parted) help                                                             
  align-<span class="hljs-keyword">check</span> <span class="hljs-keyword">TYPE</span> N                      <span class="hljs-keyword">check</span> <span class="hljs-keyword">partition</span> N <span class="hljs-keyword">for</span> <span class="hljs-keyword">TYPE</span>(min|opt) alignment
  <span class="hljs-keyword">check</span> NUMBER                            <span class="hljs-keyword">do</span> a simple <span class="hljs-keyword">check</span> <span class="hljs-keyword">on</span> the file <span class="hljs-keyword">system</span>(centos <span class="hljs-number">7</span>上已删除该功能)
  cp [<span class="hljs-keyword">FROM</span>-DEVICE] <span class="hljs-keyword">FROM</span>-NUMBER <span class="hljs-keyword">TO</span>-NUMBER  <span class="hljs-keyword">copy</span> file <span class="hljs-keyword">system</span> <span class="hljs-keyword">to</span> another <span class="hljs-keyword">partition</span>(centos <span class="hljs-number">7</span>上已删除该功能)
  help [COMMAND]                          print general help, <span class="hljs-keyword">or</span> help <span class="hljs-keyword">on</span> COMMAND
  mklabel,mktable LABEL-<span class="hljs-keyword">TYPE</span>              <span class="hljs-keyword">create</span> a <span class="hljs-built_in">new</span> disklabel (<span class="hljs-keyword">partition</span> <span class="hljs-keyword">table</span>)
  mkfs NUMBER FS-<span class="hljs-keyword">TYPE</span>                     make a FS-<span class="hljs-keyword">TYPE</span> file <span class="hljs-keyword">system</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">partition</span> NUMBER (centos <span class="hljs-number">7</span>上已删除改该功能) 
  mkpart PART-<span class="hljs-keyword">TYPE</span> [FS-<span class="hljs-keyword">TYPE</span>] <span class="hljs-keyword">START</span> <span class="hljs-keyword">END</span>    make a <span class="hljs-keyword">partition</span>
  mkpartfs PART-<span class="hljs-keyword">TYPE</span> FS-<span class="hljs-keyword">TYPE</span> <span class="hljs-keyword">START</span> <span class="hljs-keyword">END</span>    make a <span class="hljs-keyword">partition</span> <span class="hljs-keyword">with</span> a file <span class="hljs-keyword">system</span>(centos <span class="hljs-number">7</span>上已删除该功能)   
  <span class="hljs-keyword">move</span> NUMBER <span class="hljs-keyword">START</span> <span class="hljs-keyword">END</span>                   <span class="hljs-keyword">move</span> <span class="hljs-keyword">partition</span> NUMBER(centos <span class="hljs-number">7</span>上已删除该功能) 
  <span class="hljs-type">name</span> NUMBER <span class="hljs-type">NAME</span>                        <span class="hljs-type">name</span> <span class="hljs-keyword">partition</span> NUMBER <span class="hljs-keyword">as</span> <span class="hljs-type">NAME</span>
  print [devices|free|list,<span class="hljs-keyword">all</span>|NUMBER]    display the <span class="hljs-keyword">partition</span> <span class="hljs-keyword">table</span>,available devices,free space, <span class="hljs-keyword">all</span> <span class="hljs-built_in">found</span> partitions,<span class="hljs-keyword">or</span> a particular <span class="hljs-keyword">partition</span>
  quit                                    <span class="hljs-keyword">exit</span> program
  rescue <span class="hljs-keyword">START</span> <span class="hljs-keyword">END</span>                        rescue a lost <span class="hljs-keyword">partition</span> near <span class="hljs-keyword">START</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">END</span>
  resize NUMBER <span class="hljs-keyword">START</span> <span class="hljs-keyword">END</span>                 resize <span class="hljs-keyword">partition</span> NUMBER <span class="hljs-keyword">and</span> its file <span class="hljs-keyword">system</span>(修改分区大小(centos <span class="hljs-number">7</span>上已删除该功能))
  rm NUMBER                               <span class="hljs-keyword">delete</span> <span class="hljs-keyword">partition</span> NUMBER (删除分区)             
  <span class="hljs-keyword">select</span> DEVICE                           choose the device <span class="hljs-keyword">to</span> edit (重选磁盘进入parted状态)  
  <span class="hljs-keyword">set</span> NUMBER FLAG STATE                   change the FLAG <span class="hljs-keyword">on</span> <span class="hljs-keyword">partition</span> NUMBER(设置分区状态，如将其<span class="hljs-keyword">off</span>或<span class="hljs-keyword">on</span>)  
  toggle [NUMBER [FLAG]]                  toggle the state <span class="hljs-keyword">of</span> FLAG <span class="hljs-keyword">on</span> <span class="hljs-keyword">partition</span> NUMBER(修改文件系统类型，如swap、lvm)  
  unit UNIT                               <span class="hljs-keyword">set</span> the <span class="hljs-keyword">default</span> unit <span class="hljs-keyword">to</span> UNIT(修改默认单位，kB/MB/GB等)
  <span class="hljs-keyword">version</span>                                 display the <span class="hljs-keyword">version</span> number <span class="hljs-keyword">and</span> copyright information <span class="hljs-keyword">of</span> GNU Parted</code></pre>

<p>常用的命令是mklabel、rm、print、mkpart、help、quit</p>
<p>parted分区的前提是磁盘已经有分区表(partition table)或磁盘标签(disk label)，否则将显示”unrecognised disk label”，这是和fdisk/gdisk不同的地方，所以需要先使用mklabel创建标签或分区表，最常见的标签(分区表)为”msdos”和”gpt”，其中msdos分区就是MBR格式的分区表，也就是会有主分区、扩展分区和逻辑分区的概念和限制。</p>
<p>下面使用 parted 对 /dev/sdc 创建 msdos 的新分区：</p>
<pre><code class="hljs routeros">[root@localhost ~]# parted /dev/sdc
GNU Parted 2.1
Using /dev/sdb
Welcome <span class="hljs-keyword">to</span> GNU Parted!<span class="hljs-built_in"> Type </span><span class="hljs-string">&#x27;help&#x27;</span> <span class="hljs-keyword">to</span> view a list of commands.
(parted) mklabel             # 创建磁盘分区标签(分区表类型)                                               
New disk label type? msdos   # 选择msdos即MBR类型    
                             # 上面的两步也可以直接一步进行：(parted) mklabel msdos      
(parted) mkpart              # 开始进行分区     
Partition type?  primary/extended? p     # 创建主分区
File<span class="hljs-built_in"> system </span>type?  [ext2]? ext4          # 创建ext4文件系统
                                         # (注意，这里虽然指明了文件系统，但没有任何意义，后面还是需要手动格式化并选择文件系统类型)
Start? 1                                 # 分区开始位置，默认是M为单位，表示从1M开始，也可直接指定1G这种方式
End? 1024                                # 分区结束位置，<span class="hljs-attribute">1024-1</span>=1023M

(parted) p                   # print，查看分区信息
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdc: 21.5GB
Sector size (logical/physical): 512B/512B
Partition Table: msdos

Number  Start   End     Size   <span class="hljs-built_in"> Type </span>    File<span class="hljs-built_in"> system </span> Flags
 1      1049kB  1024MB  1023MB  primary

<span class="hljs-comment"># 可以一步完成一个命令中的多个动作</span>
(parted) mkpart p ext4 1026M 4096M       # 可以一步完成，也可以一步完成到任何位置，然后继续交互下一步
                                         # 可能会提示分区未对齐<span class="hljs-string">&quot;Warning: The resulting partition is not properly aligned for best performance.&quot;</span>，忽略它
(parted) mkpart e 4098 -1    # 创建扩展分区，注意创建扩展分区时不指定文件系统类型；-1表示剩余的全部分配给该分区

(parted) p                                                               
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdc: 21.5GB
Sector size (logical/physical): 512B/512B
Partition Table: msdos 

Number  Start   End     Size   <span class="hljs-built_in"> Type </span>     File<span class="hljs-built_in"> system </span> Flags
 1      1049kB  1024MB  1023MB  primary
 2      1026MB  4096MB  3070MB  primary
 3      4098MB  21.5GB  17.4GB  extended               lba

(parted) mkpart l ext4 4099 8194     # 创建逻辑分区，指定ext4
(parted) mkpart l ext4 8195 -1       # 继续创建逻辑分区
(parted) p
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdc: 21.5GB
Sector size (logical/physical): 512B/512B
Partition Table: msdos

Number  Start   End     Size   <span class="hljs-built_in"> Type </span>     File<span class="hljs-built_in"> system </span> Flags
 1      1049kB  1024MB  1023MB  primary
 2      1026MB  4096MB  3070MB  primary
 3      4098MB  21.5GB  17.4GB  extended               lba
 5      4099MB  8194MB  4095MB  logical
 6      8195MB  21.5GB  13.3GB  logical

(parted) rm 5    # 删除5号分区
(parted) p
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdc: 21.5GB
Sector size (logical/physical): 512B/512B
Partition Table: msdos

Number  Start   End     Size   <span class="hljs-built_in"> Type </span>     File<span class="hljs-built_in"> system </span> Flags
 1      1049kB  1024MB  1023MB  primary
 2      1026MB  4096MB  3070MB  primary
 3      4098MB  21.5GB  17.4GB  extended               lba
 5      8195MB  21.5GB  13.3GB  logical

(parted) quit                                    # 退出parted工具
Information: You may need <span class="hljs-keyword">to</span> update /etc/fstab.  # 提示你要更新/etc/fstab中的配置，说明该工具是可以在线分区的</code></pre>

<p><font color=red>注：虽然parted工具中指定了文件系统，但是并没有意义，它仍需要手动进行格式化并指定分区类型。</font></p>
<h1 id="二、格式化分区"><a href="#二、格式化分区" class="headerlink" title="二、格式化分区"></a>二、格式化分区</h1><h2 id="2-1-mkfs-工具"><a href="#2-1-mkfs-工具" class="headerlink" title="2.1 mkfs 工具"></a>2.1 mkfs 工具</h2><p>mkfs命令通常用于在设备硬件分区上创建linux文件系统。mkfs 命令支持建立多种 Linux 文件系统，如 ext系列，xfs等等。实际上mkfs是支持多种文件系统构建命令<code>mkfs. TYPE</code>的前部分，mkfs命令通常执行的时候也是调用<code>mkfs. TYPE</code>来执行，如mkfs.ext2，mkfs.vfs，mkfs.vfat等等。</p>
<pre><code class="hljs css"><span class="hljs-selector-attr">[root@localhost ~]</span># <span class="hljs-selector-tag">mkfs</span>
<span class="hljs-selector-tag">mkfs</span>         <span class="hljs-selector-tag">mkfs</span><span class="hljs-selector-class">.btrfs</span>   <span class="hljs-selector-tag">mkfs</span><span class="hljs-selector-class">.cramfs</span>  <span class="hljs-selector-tag">mkfs</span><span class="hljs-selector-class">.ext2</span>    <span class="hljs-selector-tag">mkfs</span><span class="hljs-selector-class">.ext3</span>    <span class="hljs-selector-tag">mkfs</span><span class="hljs-selector-class">.ext4</span>    <span class="hljs-selector-tag">mkfs</span><span class="hljs-selector-class">.minix</span>   <span class="hljs-selector-tag">mkfs</span><span class="hljs-selector-class">.xfs</span></code></pre>



<h2 id="2-2-mke2fs-工具"><a href="#2-2-mke2fs-工具" class="headerlink" title="2.2 mke2fs 工具"></a>2.2 mke2fs 工具</h2><p>mkfs.ext2、mkfs.ext3、mkfs.ext4 或 mkfs -t extX 其实都是在调用mke2fs工具。</p>
<p>该工具创建文件系统时，会从 /etc/mke2fs.conf 配置中读取默认的配置项：</p>
<pre><code class="hljs mipsasm">mke<span class="hljs-symbol">2f</span>s [ -c ] [ -<span class="hljs-keyword">b </span><span class="hljs-keyword">block-size </span>] [ -f fragment-size ] [ -g <span class="hljs-keyword">blocks-per-group </span>] [ -G number-of-groups ] 
       [ -i <span class="hljs-keyword">bytes-per-inode </span>] [ -I inode-size ] [ -<span class="hljs-keyword">j </span>] [ -N number-of-inodes ] [ -m reserved-<span class="hljs-keyword">blocks-percentage </span>] 
       [ -q ] [ -r fs-revision-level ] [ -v ] [ -L volume-label ] [ -S ] [ -t fs-type ] device [ <span class="hljs-keyword">blocks-count </span>]

选项说明：
-t fs-type         ：指定要创建的文件系统类型(<span class="hljs-keyword">ext2,ext3 </span><span class="hljs-keyword">ext4)，若不指定，则从/etc/mke2fs.conf中获取默认的文件系统类型。</span>
<span class="hljs-keyword">-b </span><span class="hljs-keyword">block-size </span>     ：指定每个<span class="hljs-keyword">block的大小，有效值有1024、2048和4096，单位是字节。</span>
<span class="hljs-keyword">-I </span>inode-size      ：指定inode大小，单位为字节。必须为<span class="hljs-number">2</span>的幂次方，且大于等于<span class="hljs-number">128</span>字节。值越大，说明inode的集合体inode table占用越多的空
                     间，这不仅会挤占文件系统中的可用空间，还会降低性能，因为要扫描inode table需要消耗更多时间，但是在linux kernel <span class="hljs-number">2</span>.<span class="hljs-number">6</span>.<span class="hljs-number">10</span>
                     之后，由于使用inode存储了很多扩展的额外属性，所以<span class="hljs-number">128</span>字节已经不够用了，因此<span class="hljs-keyword">ext4默认的inode </span>size已经变为<span class="hljs-number">256</span>，尽管
                     inode大小增大了，但因为使用inode存储扩展属性带来的性能提升远高于inode size变大导致的负面影响，所以仍建议使用<span class="hljs-number">256</span>字
                     节的inode。
-i <span class="hljs-keyword">bytes-per-inode </span>：指定每多少个字节就为其分配一个inode号。值越大，说明一个文件系统中分配的inode号越少，更适用于存储大量大文件，值越
                     小，inode号越多，更适用于存储大量小文件。该值不能小于一个<span class="hljs-keyword">block的大小，因为这样会造成inode多余。</span>
<span class="hljs-keyword"> </span>                    注意，创建文件系统后该值就不能再改变了。
-c                 ：创建文件系统前先检查设备是否有<span class="hljs-keyword">bad </span><span class="hljs-keyword">blocks。</span>
<span class="hljs-keyword">-f </span>fragment-size   ：指定fragments的大小，单位字节。
-g <span class="hljs-keyword">blocks-per-group：指定每个块组中的block数量。不建议修改此项。</span>
<span class="hljs-keyword">-G </span>number-of-groups：该选项用于<span class="hljs-keyword">ext4文件系统(严格地说是启用了flex_bg特性)，指定虚拟块组(即一个extent)中包含的块组个数，必须为2的幂次方。</span>
<span class="hljs-keyword"> </span>                    对于<span class="hljs-keyword">ext4文件系统来说，使用extent的功能能极大提升其性能。</span>
<span class="hljs-keyword">-j </span>                ：创建带有日志功能的文件系统，即<span class="hljs-keyword">ext3。如果要指定关于日志方面的设置，在-j的基础上再使用-J指定，不过一般默认即可，具体可</span>
<span class="hljs-keyword"> </span>                    指定的选项看man文档。 
-L new-volume-label：指定卷标名称，名称不得超出<span class="hljs-number">16</span>字节。
-m reserved-<span class="hljs-keyword">blocks-percentage：指定文件系统保留block数量的比例，保留一部分block，可以降低物理碎片。默认比例为5%。</span>
<span class="hljs-keyword">-N </span>number-of-inodes ：强制指定该文件系统应该分配多少个inode号，它会覆盖通过计算得出inode数量的结果(根据<span class="hljs-keyword">block大小、数量和每多少字节分配</span>
<span class="hljs-keyword"> </span>                     一个inode得出Inode数量)，但是不建议这么做。
-q                  ：安静模式，可用于脚本中
-S                  ：重建superblock和group descriptions。在所有的superblock和备份的superblock都损坏时有用。它会重新初始化superblock和
                      group descriptions，但不会改变inode table、<span class="hljs-keyword">bmap和imap(若真的改变，该分区数据就全丢了，还不如重新格式化)。在重建</span>
<span class="hljs-keyword"> </span>                     superblock后，应该执行e<span class="hljs-symbol">2f</span>sck来保证文件系统的一致性。但要注意，应该完全正确地指定<span class="hljs-keyword">block的大小，其改选项并不能完全保</span>
<span class="hljs-keyword"> </span>                     证数据不丢失。
-v                  ：输出详细执行过程</code></pre>

<p><strong>所以，有可能用到的选项也就 “-t” 指定文件系统类型，”-b” 指定 block 大小，”-I” 指定 inode 大小，”-i” 指定分配 inode 的比例。</strong></p>
<p>例如：</p>
<pre><code class="hljs routeros">[root@localhost ~]# mke2fs -t ext4 -I 256 /dev/sdb2 -b 4096
mke2fs 1.41.12 (17-May-2010)
Filesystem label=
OS type: Linux
Block <span class="hljs-attribute">size</span>=4096 (<span class="hljs-attribute">log</span>=2)
Fragment <span class="hljs-attribute">size</span>=4096 (<span class="hljs-attribute">log</span>=2)
<span class="hljs-attribute">Stride</span>=0 blocks, Stripe <span class="hljs-attribute">width</span>=0 blocks
655360 inodes, 2621440 blocks
131072 blocks (5.00%) reserved <span class="hljs-keyword">for</span> the super user
First data <span class="hljs-attribute">block</span>=0
Maximum filesystem <span class="hljs-attribute">blocks</span>=2684354560
80 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks:
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Writing inode tables: done                           
Creating journal (32768 blocks): done
Writing superblocks <span class="hljs-keyword">and</span> filesystem<span class="hljs-built_in"> accounting </span>information: done

This filesystem will be automatically checked every 39 mounts <span class="hljs-keyword">or</span>
180 days, whichever comes first.  Use tune2fs -c <span class="hljs-keyword">or</span> -i <span class="hljs-keyword">to</span> override.</code></pre>



<h1 id="三、查看文件系统状态信息"><a href="#三、查看文件系统状态信息" class="headerlink" title="三、查看文件系统状态信息"></a>三、查看文件系统状态信息</h1><h2 id="3-1-lsblk-list-block-devices"><a href="#3-1-lsblk-list-block-devices" class="headerlink" title="3.1 lsblk(list block devices)"></a>3.1 lsblk(list block devices)</h2><blockquote>
<p>用于列出设备及其状态，主要列出非空的存储设备。其实它只会列出/sys/dev/block中的主次设备号文件，且默认只列出非空设备。</p>
</blockquote>
<pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>localhost ~]# lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="hljs-number">8</span>:<span class="hljs-number">0</span>    <span class="hljs-number">0</span>   <span class="hljs-number">20</span>G  <span class="hljs-number">0</span> disk 
├─sda1            <span class="hljs-number">8</span>:<span class="hljs-number">1</span>    <span class="hljs-number">0</span>    <span class="hljs-number">1</span>G  <span class="hljs-number">0</span> part /boot
└─sda2            <span class="hljs-number">8</span>:<span class="hljs-number">2</span>    <span class="hljs-number">0</span>   <span class="hljs-number">19</span>G  <span class="hljs-number">0</span> part 
  ├─centos-root <span class="hljs-number">253</span>:<span class="hljs-number">0</span>    <span class="hljs-number">0</span>   <span class="hljs-number">17</span>G  <span class="hljs-number">0</span> lvm  /
  └─centos-swap <span class="hljs-number">253</span>:<span class="hljs-number">1</span>    <span class="hljs-number">0</span>    <span class="hljs-number">2</span>G  <span class="hljs-number">0</span> lvm  [SWAP]
sdb               <span class="hljs-number">8</span>:<span class="hljs-number">16</span>   <span class="hljs-number">0</span>  <span class="hljs-number">1.8</span>T  <span class="hljs-number">0</span> disk 
└─sdb1            <span class="hljs-number">8</span>:<span class="hljs-number">17</span>   <span class="hljs-number">0</span>  <span class="hljs-number">1.8</span>T  <span class="hljs-number">0</span> part 
sr0              <span class="hljs-number">11</span>:<span class="hljs-number">0</span>    <span class="hljs-number">1</span>  <span class="hljs-number">4.5</span>G  <span class="hljs-number">0</span> rom</code></pre>

<p>其中上面的几列意义如下：</p>
<p>NAME：设备名称；</p>
<p>MAJ:MIN：主设备号和此设备号；</p>
<p>RM：是否为可卸载设备，1表示可卸载设备。可卸载设备如光盘、USB等。并非能够umount的就是可卸载的；</p>
<p>SIZE：设备总空间大小；</p>
<p>RO：是否为只读；</p>
<p>TYPE：是磁盘disk，还是分区part，亦或是rom，还有loop设备；</p>
<p>mountpoint：挂载点。</p>
<p>另外常用的一个选项是”-f”，它可以查看到文件系统类型，和文件系统的uuid和挂载点：</p>
<pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>localhost ~]# lsblk -f
NAME            FSTYPE      LABEL           UUID                                   MOUNTPOINT
sda                                                                                
├─sda1          xfs                         <span class="hljs-number">39</span>b6f37f<span class="hljs-number">-531f</span><span class="hljs-number">-41</span>c2-a498-dbe216fcfc4b   /boot
└─sda2          LVM2_member                 BVd9cM-wbZz-QBn3<span class="hljs-number">-8</span>IOg-A8Xc-NZ5w-u98gYr 
  ├─centos-root xfs                         <span class="hljs-number">0</span>a8b095d<span class="hljs-number">-743e-494</span>b-a4e3<span class="hljs-number">-1</span>dca4211d9bb   /
  └─centos-swap swap                        b83b56ce<span class="hljs-number">-37f</span>2<span class="hljs-number">-460</span>a-bbd1<span class="hljs-number">-8</span>d4da4624493   [SWAP]
sdb                                                                                
└─sdb1          ext4                        <span class="hljs-number">2</span>bc92060-a128<span class="hljs-number">-4</span>ad5-bfbe<span class="hljs-number">-9</span>cfb61dc1870   
sr0             iso9660     CentOS <span class="hljs-number">7</span> x86_64 <span class="hljs-number">2020</span><span class="hljs-number">-04</span><span class="hljs-number">-22</span><span class="hljs-number">-00</span><span class="hljs-number">-54</span><span class="hljs-number">-00</span><span class="hljs-number">-00</span></code></pre>

<p><font color=red>注：每个已经格式化的文件系统都有其类型和uuid，而没有格式化的设备(如/dev/sdb3)，将只显示一个Name结果，表示该设备还未进行格式化。</font></p>
<h2 id="3-2-blkid"><a href="#3-2-blkid" class="headerlink" title="3.2 blkid"></a>3.2 blkid</h2><p>查看文件系统类型和uuid：</p>
<pre><code class="hljs routeros">[root@localhost ~]# blkid
/dev/sr0: <span class="hljs-attribute">UUID</span>=<span class="hljs-string">&quot;2020-04-22-00-54-00-00&quot;</span> <span class="hljs-attribute">LABEL</span>=<span class="hljs-string">&quot;CentOS 7 x86_64&quot;</span> <span class="hljs-attribute">TYPE</span>=<span class="hljs-string">&quot;iso9660&quot;</span> <span class="hljs-attribute">PTTYPE</span>=<span class="hljs-string">&quot;dos&quot;</span> 
/dev/sda1: <span class="hljs-attribute">UUID</span>=<span class="hljs-string">&quot;39b6f37f-531f-41c2-a498-dbe216fcfc4b&quot;</span> <span class="hljs-attribute">TYPE</span>=<span class="hljs-string">&quot;xfs&quot;</span> 
/dev/sda2: <span class="hljs-attribute">UUID</span>=<span class="hljs-string">&quot;BVd9cM-wbZz-QBn3-8IOg-A8Xc-NZ5w-u98gYr&quot;</span> <span class="hljs-attribute">TYPE</span>=<span class="hljs-string">&quot;LVM2_member&quot;</span> 
/dev/mapper/centos-root: <span class="hljs-attribute">UUID</span>=<span class="hljs-string">&quot;0a8b095d-743e-494b-a4e3-1dca4211d9bb&quot;</span> <span class="hljs-attribute">TYPE</span>=<span class="hljs-string">&quot;xfs&quot;</span> 
/dev/mapper/centos-swap: <span class="hljs-attribute">UUID</span>=<span class="hljs-string">&quot;b83b56ce-37f2-460a-bbd1-8d4da4624493&quot;</span> <span class="hljs-attribute">TYPE</span>=<span class="hljs-string">&quot;swap&quot;</span> 
/dev/sdb1: <span class="hljs-attribute">UUID</span>=<span class="hljs-string">&quot;2bc92060-a128-4ad5-bfbe-9cfb61dc1870&quot;</span> <span class="hljs-attribute">TYPE</span>=<span class="hljs-string">&quot;ext4&quot;</span></code></pre>

<h2 id="3-3-du"><a href="#3-3-du" class="headerlink" title="3.3 du"></a>3.3 du</h2><blockquote>
<p>du命令用于评估文件的空间占用情况，它会统计每个文件的大小，统计时会递归统计目录中的文件，也就是说，它会遍历整个待统计目录，所以统计速度上可能并不理想。</p>
</blockquote>
<pre><code class="hljs jboss-cli">du [OPTION]<span class="hljs-string">...</span> [FILE]<span class="hljs-string">...</span>
选项说明：
-a, <span class="hljs-params">--all</span>：列出目录中所有文件的统计信息，默认只会列出目录中子目录的统计信息，而不列出文件的统计信息
-h, <span class="hljs-params">--human-readable</span>：人性化显示大小
-0, <span class="hljs-params">--null</span>：以空字符结尾，即<span class="hljs-string">&quot;\0&quot;</span>而非换行的<span class="hljs-string">&quot;\n&quot;</span>
-S, <span class="hljs-params">--separate-dirs</span>：不包含子目录的大小
-s, <span class="hljs-params">--summarize</span>：对目录做总的统计，不列出目录内文件的大小信息
-c,<span class="hljs-params">--total</span>：对给出的文件或目录做总计。在统计非同一个目录文件大小时非常有用。见下文例子。
-d,<span class="hljs-params">--max-depth</span>：指定显示时的目录深度，默认会递归显示所有层次
<span class="hljs-params">--max-depth=N</span>：只列出给定层次的目录统计，如果N=0，则等价于<span class="hljs-string">&quot;-s&quot;</span>
-x, <span class="hljs-params">--one-file-system</span>：忽略不同文件系统上的文件，不对它们进行统计
-X, <span class="hljs-params">--exclude-from=FILE</span>：从文件中读取要排除的文件
<span class="hljs-params">--exclude=PATTERN</span>：指定要忽略不统计的文件</code></pre>

<pre><code class="hljs gradle">[root@localhost ~]# du -sh <span class="hljs-regexp">/etc/</span>
<span class="hljs-number">35</span>M     <span class="hljs-regexp">/etc/</span></code></pre>

<pre><code class="hljs gradle">[root@localhost ~]# du -ah <span class="hljs-regexp">/tmp/</span>
<span class="hljs-number">0</span>       <span class="hljs-regexp">/tmp/</span>.Test-unix
<span class="hljs-number">0</span>       <span class="hljs-regexp">/tmp/</span>.font-unix
<span class="hljs-number">0</span>       <span class="hljs-regexp">/tmp/</span>.ICE-unix
<span class="hljs-number">0</span>       <span class="hljs-regexp">/tmp/</span>.XIM-unix
<span class="hljs-number">0</span>       <span class="hljs-regexp">/tmp/</span>.X11-unix
<span class="hljs-number">4.0</span>K    <span class="hljs-regexp">/tmp/</span>oraysl.status
<span class="hljs-number">4.0</span>K    <span class="hljs-regexp">/tmp/</span>oraynewph.status
<span class="hljs-number">0</span>       <span class="hljs-regexp">/tmp/</span>systemd-<span class="hljs-keyword">private</span>-dd51c630d55b47ac953c22e69a6c1240-mariadb.service-jPbRmD/tmp
<span class="hljs-number">0</span>       <span class="hljs-regexp">/tmp/</span>systemd-<span class="hljs-keyword">private</span>-dd51c630d55b47ac953c22e69a6c1240-mariadb.service-jPbRmD
<span class="hljs-number">8.0</span>K    <span class="hljs-regexp">/tmp/</span>
</code></pre>

<h2 id="3-4-df"><a href="#3-4-df" class="headerlink" title="3.4 df"></a>3.4 df</h2><p>df 用于报告磁盘空间使用率，默认显示的大小是1K大小block数量，也就是以k为单位。</p>
<p>和 du 不同的是，df 是读取每个文件系统的 superblock 信息，所以评估速度非常快。由于是读取 superblock，所以如果目录下挂载了另一个文件系统，是不会将此挂载的文件系统计入目录大小的。<strong>注意，du 和 df 统计的结果是不一样的。</strong></p>
<p>如果用 df 统计某个文件的空间使用情况，将会转而统计该文件所在文件系统的空间使用情况。</p>
<pre><code class="hljs angelscript">df [OPTION]... [FILE]...
选项说明：
-h：人性化转换大小的显示单位
-i：统计inode使用情况而非空间使用情况
-l, --local：只列出本地文件系统的使用情况，不列出网络文件系统信息
-T, --print-type：同时输出文件系统类型
-t, --type=TYPE：只列出给定文件系统的统计信息
-x, --exclude-type=TYPE：指定不显示的文件系统类型的统计信息

[<span class="hljs-symbol">root@</span>localhost ~]# df -hT
文件系统                类型      容量  已用  可用 已用% 挂载点
devtmpfs                devtmpfs  <span class="hljs-number">908</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">908</span>M    <span class="hljs-number">0</span>% /dev
tmpfs                   tmpfs     <span class="hljs-number">919</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">919</span>M    <span class="hljs-number">0</span>% /dev/shm
tmpfs                   tmpfs     <span class="hljs-number">919</span>M   <span class="hljs-number">33</span>M  <span class="hljs-number">887</span>M    <span class="hljs-number">4</span>% /run
tmpfs                   tmpfs     <span class="hljs-number">919</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">919</span>M    <span class="hljs-number">0</span>% /sys/fs/cgroup
/dev/mapper/centos-root xfs        <span class="hljs-number">17</span>G  <span class="hljs-number">2.4</span>G   <span class="hljs-number">15</span>G   <span class="hljs-number">14</span>% /
/dev/sda1               xfs      <span class="hljs-number">1014</span>M  <span class="hljs-number">211</span>M  <span class="hljs-number">804</span>M   <span class="hljs-number">21</span>% /boot
tmpfs                   tmpfs     <span class="hljs-number">184</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">184</span>M    <span class="hljs-number">0</span>% /run/user/<span class="hljs-number">0</span>

[<span class="hljs-symbol">root@</span>localhost ~]# df -i
文件系统                  Inode 已用(I) 可用(I) 已用(I)% 挂载点
devtmpfs                 <span class="hljs-number">232254</span>     <span class="hljs-number">405</span>  <span class="hljs-number">231849</span>       <span class="hljs-number">1</span>% /dev
tmpfs                    <span class="hljs-number">235193</span>       <span class="hljs-number">1</span>  <span class="hljs-number">235192</span>       <span class="hljs-number">1</span>% /dev/shm
tmpfs                    <span class="hljs-number">235193</span>     <span class="hljs-number">542</span>  <span class="hljs-number">234651</span>       <span class="hljs-number">1</span>% /run
tmpfs                    <span class="hljs-number">235193</span>      <span class="hljs-number">16</span>  <span class="hljs-number">235177</span>       <span class="hljs-number">1</span>% /sys/fs/cgroup
/dev/mapper/centos-root <span class="hljs-number">8910848</span>   <span class="hljs-number">78419</span> <span class="hljs-number">8832429</span>       <span class="hljs-number">1</span>% /
/dev/sda1                <span class="hljs-number">524288</span>     <span class="hljs-number">339</span>  <span class="hljs-number">523949</span>       <span class="hljs-number">1</span>% /boot
tmpfs                    <span class="hljs-number">235193</span>       <span class="hljs-number">1</span>  <span class="hljs-number">235192</span>       <span class="hljs-number">1</span>% /run/user/<span class="hljs-number">0</span>
</code></pre>

<h1 id="四、挂载和卸载文件系统"><a href="#四、挂载和卸载文件系统" class="headerlink" title="四、挂载和卸载文件系统"></a>四、挂载和卸载文件系统</h1><h2 id="4-1-mount"><a href="#4-1-mount" class="headerlink" title="4.1 mount"></a>4.1 mount</h2><blockquote>
<p>mount用来显示挂载信息或者进行文件系统挂载，它的功能及其的强大(强大到离谱)，它不仅支持挂载非常多种文件系统，如ext/xfs/nfs/smbfs/cifs (win上的共享目录)等，还支持共享挂载点、继承挂载点(父子关系)、绑定挂载点、移动挂载点等等功能。在本文只介绍其最简单的挂载功能。</p>
</blockquote>
<pre><code class="hljs routeros">mount # 将显示当前已挂载信息
mount [-t 欲挂载文件系统类型 ] [-o 特殊选项] 设备名 挂载目录

选项说明：
-a  将/etc/fstab文件里指定的挂载选项重新挂载一遍。
-t  支持ext2/ext3/ext4/vfat/fat/iso9660(光盘默认格式)。 不用-t时默认会调用blkid来获取文件系统类型。
-n  不把挂载记录写在/etc/mtab文件中，一般挂载会在/proc/mounts中记录下挂载信息，然后同步到/etc/mtab，指定-n表示不同步该挂载信息。
-o  指定挂载特殊选项。下面是两个比较常用的：
    loop  挂载镜像文件，如iso文件
    ro  只读挂载
    rw  读写挂载
    auto  相当于mount -a
    dev 如果挂载的文件系统中有设备访问入口则启用它，使其可以作为设备访问入口
   <span class="hljs-built_in"> default </span>rw,suid,dev,exec,auto,nouser,async,<span class="hljs-keyword">and</span> relatime
    async   异步挂载，只写到内存
    sync    同步挂载，通过挂载位置写入对方硬盘
    atime   修改访问时间，每次访问都修改atime会导致性能降低，所以默认是noatime
    noatime 不修改访问时间，高并发时使用这个选项可以减少磁盘IO
    nodiratime  不修改文件夹访问时间，高并发时使用这个选项可以减少磁盘IO
    exec/noexec  挂载后的文件系统里的可执行程序是否可执行，默认是可以执行exec， 优先级高于权限的限定
    remount  重新挂载，此时可以不用指定挂载点。
    suid/nosuid 对挂载的文件系统启用或禁用suid，对于外来设备最好禁用suid
    _netdev 需要网络挂载时默认将停留在挂载界面直到加载网络了。使用_netdev可以忽略网络正常挂载。如NFS开机挂载。
   <span class="hljs-built_in"> user </span> 允许普通用户进行挂载该目录，但只允许挂载者进行卸载该目录
   <span class="hljs-built_in"> users </span> 允许所有用户挂载和卸载该目录
    nouser  禁止普通用户挂载和卸载该目录，这是默认的，默认情况下一个目录不指定user/users时，将只有root能挂载</code></pre>

<p>使用实例：</p>
<p><strong>(1).挂载CentOS的安装镜像到/mnt。</strong></p>
<pre><code class="hljs awk">mount <span class="hljs-regexp">/dev/</span>cdrom /mnt</code></pre>

<p><strong>(2).重新挂载。</strong></p>
<pre><code class="hljs apache"><span class="hljs-attribute">mount</span> -t ext<span class="hljs-number">4</span> -o remount /dev/sdb<span class="hljs-number">1</span> /data<span class="hljs-number">1</span></code></pre>

<p><strong>(3).重新挂载文件系统为可读写</strong></p>
<pre><code class="hljs apache"><span class="hljs-attribute">mount</span> -t ext<span class="hljs-number">4</span> -o rw remount /dev/sdb<span class="hljs-number">1</span> /data<span class="hljs-number">1</span></code></pre>

<p><strong>(4).挂载windows的共享目录。</strong></p>
<p>win上共享文件的文件系统是cifs类型，要在Linux上挂载，必须得有mount.cifs命令，如果没有则安装cifs-utils包。</p>
<p>假设win上共享目录的unc路径为\192.168.100.8\test，共享给的用户名和密码分别为long3:123，要挂在linux上的/mydata目录上。</p>
<pre><code class="hljs awk">mount.cifs -o username=<span class="hljs-string">&quot;long3&quot;</span>,password=<span class="hljs-string">&quot;123&quot;</span> <span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">100.8</span><span class="hljs-regexp">/test /my</span>data</code></pre>

<p>注意，如果是比较新版本的win10(2017年之后更新的版本)或较新版本的win server，直接mount.cifs会报错：</p>
<pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>localhost ~]# mount.cifs -o username=<span class="hljs-string">&quot;long3&quot;</span>,password=<span class="hljs-string">&quot;123&quot;</span> <span class="hljs-comment">//192.168.100.8/test /mnt         </span>
mount error(<span class="hljs-number">112</span>): Host <span class="hljs-keyword">is</span> down
Refer to the mount.cifs(<span class="hljs-number">8</span>) manual page (e.g. man mount.cifs)</code></pre>

<p>这是因为2017年微软的一个补丁禁用了SMBv1协议，通过smbclient的报告可知：</p>
<pre><code class="hljs autoit">[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># yum -y install samba-client</span>
[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># smbclient -L //192.168.100.8</span>
Enter root<span class="hljs-string">&#x27;s password: </span>
<span class="hljs-string">protocol negotiation failed: NT_STATUS_CONNECTION_RESET</span></code></pre>

<p>因此，在mount的时候指定cifs(SMB)的版本号为2.0即可：</p>
<pre><code class="hljs cpp">[root@localhost ~]<span class="hljs-meta"># mount.cifs -o username=<span class="hljs-meta-string">&quot;long3&quot;</span>,password=<span class="hljs-meta-string">&quot;123&quot;</span>,vers=2.0 <span class="hljs-comment">//192.168.100.8/test /mnt</span></span></code></pre>

<h2 id="4-2-挂载镜像文件"><a href="#4-2-挂载镜像文件" class="headerlink" title="4.2 挂载镜像文件"></a>4.2 挂载镜像文件</h2><p>有时候需要挂载CentOS的镜像文件，在虚拟机中经常是将镜像放入虚拟机的CD/DVD虚拟光驱中，然后在Linux上对/dev/cdrom进行挂载。其实/dev/cdrom是/dev/sr0的一个软链接，/dev/sr0是Linux中的光驱，所以上面的过程相当于是将镜像文件通过虚拟软件的虚拟光驱和linux的光驱连接起来，这样只需要挂载Linux中的光驱就可以了。但是，在非虚拟环境中没有虚拟光驱，而且在Linux中的一个镜像文件难道一定要拷贝到主机上通过虚拟光驱进行连接吗？</p>
<p>mount是一个极其强大的挂载工具，它支持挂载很多种文件类型，其中就支持挂载镜像文件，其实它连挂载目录都支持。</p>
<pre><code class="hljs angelscript">mount -o loop CentOS<span class="hljs-number">-6.6</span>-x86_64-bin-DVD2.iso /mnt

[<span class="hljs-symbol">root@</span>localhost ~]# lsblk
NAME     MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
loop0      <span class="hljs-number">7</span>:<span class="hljs-number">0</span>    <span class="hljs-number">0</span>   <span class="hljs-number">1.2</span>G  <span class="hljs-number">0</span> loop /mnt
sda        <span class="hljs-number">8</span>:<span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">20</span>G  <span class="hljs-number">0</span> disk
├─sda1   <span class="hljs-number">8</span>:<span class="hljs-number">1</span>    <span class="hljs-number">0</span>   <span class="hljs-number">250</span>M  <span class="hljs-number">0</span> part /boot
├─sda2   <span class="hljs-number">8</span>:<span class="hljs-number">2</span>    <span class="hljs-number">0</span>  <span class="hljs-number">17.8</span>G  <span class="hljs-number">0</span> part /
└─sda3   <span class="hljs-number">8</span>:<span class="hljs-number">3</span>    <span class="hljs-number">0</span>     <span class="hljs-number">2</span>G  <span class="hljs-number">0</span> part [SWAP]
sr0       <span class="hljs-number">11</span>:<span class="hljs-number">0</span>    <span class="hljs-number">1</span>  <span class="hljs-number">1024</span>M  <span class="hljs-number">0</span> rom</code></pre>

<h2 id="4-3-umount"><a href="#4-3-umount" class="headerlink" title="4.3 umount"></a>4.3 umount</h2><pre><code class="hljs properties"><span class="hljs-attr">umount</span> <span class="hljs-string">设备名或挂载目录</span>
<span class="hljs-attr">umount</span> <span class="hljs-string">-lf 强制卸载</span></code></pre>

<h2 id="4-4-开机自动挂载-etc-fstab"><a href="#4-4-开机自动挂载-etc-fstab" class="headerlink" title="4.4 开机自动挂载/etc/fstab"></a>4.4 开机自动挂载/etc/fstab</h2><p>通过将挂载选项写入到 /etc/fstab 中，系统会自动挂载该文件中的配置项。但要注意，该文件在开机的前几个过程中就被读取，所以配置错误很可能会导致开机失败。</p>
<pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>localhost ~]# cat /etc/fstab 

#
# /etc/fstab
# Created by anaconda on Sat Jun  <span class="hljs-number">6</span> <span class="hljs-number">20</span>:<span class="hljs-number">09</span>:<span class="hljs-number">07</span> <span class="hljs-number">2020</span>
#
# Accessible filesystems, by <span class="hljs-built_in">ref</span>erence, are maintained under <span class="hljs-string">&#x27;/dev/disk&#x27;</span>
# See man pages fstab(<span class="hljs-number">5</span>), findfs(<span class="hljs-number">8</span>), mount(<span class="hljs-number">8</span>) <span class="hljs-keyword">and</span>/<span class="hljs-keyword">or</span> blkid(<span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> more info
#
/dev/mapper/centos-root /                       xfs     defaults        <span class="hljs-number">0</span> <span class="hljs-number">0</span>
UUID=<span class="hljs-number">39</span>b6f37f<span class="hljs-number">-531f</span><span class="hljs-number">-41</span>c2-a498-dbe216fcfc4b /boot                   xfs     defaults        <span class="hljs-number">0</span> <span class="hljs-number">0</span>
/dev/mapper/centos-swap swap                    swap    defaults        <span class="hljs-number">0</span> <span class="hljs-number">0</span></code></pre>

<p>其中最后两列，它们分别表示备份文件系统和开机自检，一般都可以设置为0。</p>
<p>由于能用的备份工具众多，没人会在这里设置备份，所以备份列设置为0。</p>
<p>最后一列是开机自检设置列，开机自检调用的是fsck程序，所有有些ext类文件系统作为”/“时，可能会设置为1，但是fsck是不支持xfs文件系统的，所以对于xfs文件系统而言，该项必须设置为0。</p>
<p>其实无需考虑那么多，直接将这两列设置为0就可以了。</p>
<h2 id="4-5-修复错误的-etc-fstab"><a href="#4-5-修复错误的-etc-fstab" class="headerlink" title="4.5 修复错误的/etc/fstab"></a>4.5 修复错误的/etc/fstab</h2><p>万一 /etc/fstab 配置错误，导致开机无法加载。这时提示输入 root 密码进入单人维护模式，只不过单人模式下根文件系统是只读的，哪怕是 root 也无法直接修改 /etc/fstab，所以应该将”/“文件系统进行重新挂载。</p>
<p>执行下面的命令，重挂载根分区，并给读写权限，再去修改错误的 fstab 文件记录，再重启。</p>
<pre><code class="hljs excel">mount -<span class="hljs-built_in">n</span> -o remount,rw /</code></pre>

<h1 id="五、SWAP-分区"><a href="#五、SWAP-分区" class="headerlink" title="五、SWAP 分区"></a>五、SWAP 分区</h1><h2 id="5-1-查看哪个分区在充当-swap-分区"><a href="#5-1-查看哪个分区在充当-swap-分区" class="headerlink" title="5.1 查看哪个分区在充当 swap 分区"></a>5.1 查看哪个分区在充当 swap 分区</h2><pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>localhost ~]# lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="hljs-number">8</span>:<span class="hljs-number">0</span>    <span class="hljs-number">0</span>   <span class="hljs-number">20</span>G  <span class="hljs-number">0</span> disk 
├─sda1            <span class="hljs-number">8</span>:<span class="hljs-number">1</span>    <span class="hljs-number">0</span>    <span class="hljs-number">1</span>G  <span class="hljs-number">0</span> part /boot
└─sda2            <span class="hljs-number">8</span>:<span class="hljs-number">2</span>    <span class="hljs-number">0</span>   <span class="hljs-number">19</span>G  <span class="hljs-number">0</span> part 
  ├─centos-root <span class="hljs-number">253</span>:<span class="hljs-number">0</span>    <span class="hljs-number">0</span>   <span class="hljs-number">17</span>G  <span class="hljs-number">0</span> lvm  /
  └─centos-swap <span class="hljs-number">253</span>:<span class="hljs-number">1</span>    <span class="hljs-number">0</span>    <span class="hljs-number">2</span>G  <span class="hljs-number">0</span> lvm  [SWAP]
sdb               <span class="hljs-number">8</span>:<span class="hljs-number">16</span>   <span class="hljs-number">0</span>  <span class="hljs-number">1.8</span>T  <span class="hljs-number">0</span> disk 
└─sdb1            <span class="hljs-number">8</span>:<span class="hljs-number">17</span>   <span class="hljs-number">0</span>  <span class="hljs-number">1.8</span>T  <span class="hljs-number">0</span> part 
sr0              <span class="hljs-number">11</span>:<span class="hljs-number">0</span>    <span class="hljs-number">1</span>  <span class="hljs-number">4.5</span>G  <span class="hljs-number">0</span> rom 
[<span class="hljs-symbol">root@</span>localhost ~]# swapon  -s
文件名                          类型            大小    已用    权限
/dev/dm<span class="hljs-number">-1</span>                               partition       <span class="hljs-number">2097148</span> <span class="hljs-number">0</span>       <span class="hljs-number">-2</span>
</code></pre>

<h2 id="5-2-添加-swap-分区"><a href="#5-2-添加-swap-分区" class="headerlink" title="5.2 添加 swap 分区"></a>5.2 添加 swap 分区</h2><p>(1).可以新分一个区，在分区时指定其分区的ID号为SWAP类型。</p>
<p>(2).格式化为swap分区：mkswap</p>
<pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>localhost ~]# mkswap /dev/sdb5
Setting up swapspace version <span class="hljs-number">1</span>, size = <span class="hljs-number">1951096</span> KiB
no label, UUID=<span class="hljs-number">02e5</span>af44<span class="hljs-number">-2</span>a16<span class="hljs-number">-479</span>d-b689<span class="hljs-number">-4e100</span>af6adf5</code></pre>

<p>(3).加入swap分区空间(swapon)：</p>
<pre><code class="hljs yaml">[<span class="hljs-string">root@localhost</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># swapon /dev/sdb5  </span>

[<span class="hljs-string">root@localhost</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># free -m</span>
             <span class="hljs-string">total</span>       <span class="hljs-string">used</span>       <span class="hljs-string">free</span>     <span class="hljs-string">shared</span>    <span class="hljs-string">buffers</span>     <span class="hljs-string">cached</span>
<span class="hljs-attr">Mem:</span>          <span class="hljs-number">1861        </span><span class="hljs-number">343</span>       <span class="hljs-number">1517          </span><span class="hljs-number">0</span>         <span class="hljs-number">16</span>        <span class="hljs-number">196</span>
<span class="hljs-string">-/+</span> <span class="hljs-attr">buffers/cache:</span>        <span class="hljs-number">131</span>       <span class="hljs-number">1730</span>
<span class="hljs-attr">Swap:</span>         <span class="hljs-number">3953          </span><span class="hljs-number">0</span>       <span class="hljs-number">3953</span></code></pre>

<p>(4).取消swap分区空间(swapoff)：</p>
<pre><code class="hljs yaml">[<span class="hljs-string">root@xuexi</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># swapoff /dev/sdb5</span>

[<span class="hljs-string">root@xuexi</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># free -m</span>
             <span class="hljs-string">total</span>       <span class="hljs-string">used</span>       <span class="hljs-string">free</span>     <span class="hljs-string">shared</span>    <span class="hljs-string">buffers</span>     <span class="hljs-string">cached</span>
<span class="hljs-attr">Mem:</span>          <span class="hljs-number">1861        </span><span class="hljs-number">343</span>       <span class="hljs-number">1518          </span><span class="hljs-number">0</span>         <span class="hljs-number">16</span>        <span class="hljs-number">196</span>
<span class="hljs-string">-/+</span> <span class="hljs-attr">buffers/cache:</span>        <span class="hljs-number">130</span>       <span class="hljs-number">1731</span>
<span class="hljs-attr">Swap:</span>            <span class="hljs-number">0</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span></code></pre>

<p>(5).开机自动加载swap分区：</p>
<p>修改/etc/fstab，加上一行</p>
<pre><code class="hljs angelscript">/dev/sda5    swap    swap    defaults    <span class="hljs-number">0</span>    <span class="hljs-number">0</span></code></pre>





<blockquote>
<p>学习于[<a target="_blank" rel="noopener" href="https://www.cnblogs.com/f-ck-need-u/">骏马金龙</a>]</p>
</blockquote>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Linux/">Linux</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Linux/">Linux</a>
                    
                  </div>
                
              </div>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/07/22/ip_netmask/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">IP 子网划分</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/06/01/Linux_boot/">
                        <span class="hidden-mobile">Linux 开机详细流程</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "关于 Linux 分区的小事&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 100,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>






















</body>
</html>
